# Decoder1

:warning: The section is in development.

Status: Find out what are the 5 additional decoder inputs, except the IR value. A double check of the correctness of the restored trees is required.

![locator_decoder1](/imgstore/locator_decoder1.png)

Decoder1 makes a preliminary decoding of the operation code, which will then be refined in Decoder2.

Topology features:

![decoder1](/imgstore/decoder1.jpg)

- Each decoder output is a branched NAND
- The output of a whole NAND tree can be `0` only when all inputs of _at least one_ "branch" are equal to `1`.
- During CLK = 0 a Precharge is made
- During CLK = 1 an operation (Eval) is committed
- Value is inverted by regular CMOS inverter

Dynamic logic is used.

## Decoder1 Inputs

|Input|From|Meaning|
|---|---|---|
|a0|Inplace|~a1|
|a1|Sequencer| ??? TBD. |
|a2|Inplace|~a3|
|a3|Sequencer| ??? TBD. |
|a4|Inplace|~a5|
|a5|IR|IR\[7\]|
|a6|Inplace|~a7|
|a7|IR|IR\[6\]|
|a8|Inplace|~a9|
|a9|IR|IR\[5\]|
|a10|Inplace|~a11|
|a11|IR|IR\[4\]|
|a12|Inplace|~a13|
|a13|IR|IR\[3\]|
|a14|Inplace|~a15|
|a15|IR|IR\[2\]|
|a16|Inplace|~a17|
|a17|IR|IR\[1\]|
|a18|Inplace|~a19|
|a19|IR|IR\[0\]|
|a20|Sequencer| ??? TBD. |
|a21|Inplace|~a20|
|a22|Sequencer| ??? TBD. |
|a23|Inplace|~a22|
|a24|Sequencer| ??? TBD. |
|a25|Inplace|~a24|

## Decoder1 Output Drivers

![decoder1_drv](/imgstore/modules/decoder1_drv.jpg)

The output drivers act as signal amplifiers and are also used as "domino" logic, to translate dynamic CMOS logic into conventional logic.

## Decoder1 Output Trees

:warning: Some inputs are twisted, be careful (e.g. a9 for the first three values).

|Tree|Paths|To|Description|
|---|---|---|---|
|d0|{0,2,5,7,9,10,13,14,17,18,20,23,24}| | |
|d1|{0,2,5,7,9,11,13,14,17,18,20,23,24}| | |
|d2|{0,2,5,7,9,11,13,14,17,18,20,23,25}| | |
|d3|{0,2,5,6}<br/>{0,2,5,7,15,17,18}| |All ALU opcodes in range 0x80-0xbf + ALU opcodes 0xc6/0xce, 0xd6/0xde, 0xe6/0xee, 0xf6/0xfe ("bottom yellow")|
|d4|{0,2,5,7,8,14,17,18,22,25}| | |
|d5|{0,2,5,7,8,15,16,18,22,25}| | |
|d6|{0,2,5,7,8,14,16,18,22,24}| | |
|d7|{0,2,4,6,9,14,16,18,22,24}| | |
|d8|{0,2,5,7,9,11,12,14,18}|Decoder3 (not used in Decoder2)| |
|d9|{0,2,5,7,8,10,13,15,16,20,22,24}<br/>{0,2,5,7,8,15,16,18,20,22,24}| | |
|d10|{0,2,5,7,8,10,13,15,16,20,22,25}<br/>{0,2,5,7,8,15,16,18,20,22,25}| | |
|d11|{0,2,5,7,8,10,13,15,16,20,23,24}<br/>{0,2,5,7,8,15,16,18,20,23,24}| | |
|d12|{0,2,5,7,8,10,13,15,16,20,23,25}<br/>{0,2,5,7,8,15,16,18,20,23,25}| | |
|d13|{0,2,5,7,8,10,13,15,16,21,22,24}<br/>{0,2,5,7,8,15,16,18,21,22,24}| | |
|d14|{0,2,4,6,15,17,18}|Decoder3 (not used in Decoder2)|LD reg/(HL),d8|
|d15|{0,2,4,6,22,24}| | |
|d16|{0,2,4,6,13,15,17,18,22,25}<br/>{0,2,4,6,10,15,17,18,22,25}<br/>{0,2,4,6,8,15,17,18,22,25}| | |
|d17|{0,2,21,23,24}| | |
|d18|{2,21,23,25}| | |
|d19|{0,2,4,6,9,14,16,18,22,25}<br/>{0,2,4,6,8,11,13,14,16,18,22,25}| | |
|d20|{0,2,4,6,9,14,16,18,22,24}<br/>{0,2,4,6,8,11,13,14,16,18,22,24}| | |
|d21|{0,2,5,7,9,10,13,14,16,18,20,24,25}| | |
|d22|{0,2,5,7,9,11,13,14,16,18,23,24}| | |
|d23|{0,3,5,6,14,22,24}<br/>{0,3,5,6,16,22,24}<br/>{0,3,5,6,19,22,24}| | |
|d24|{0,3,5,6,15,17,18,22,25}| | |
|d25|{0,2,4,6,8,15,17,19}|Decoder3 (not used in Decoder2)|Rotate instructions (RLCA/RRCA/RLA/RRA)|
|d26|{0,2,4,6,13,14,17,18,22,25}| | |
|d27|{0,2,3,4,7}| | |
|d28|{0,2,4,6,12,14,17,18,22,24}| | |
|d29|{0,2,4,6,13,14,17,18,22,24}| | |
|d30|{0,2,5,7,9,10,12,14,17,18,22,24}| | |
|d31|{0,2,5,7,9,10,12,14,16,18,22,24}| | |
|d32|{0,2,5,7,9,10,12,14,16,18,22,25}| | |
|d33|{0,2,4,7,8,15,17,18,22,24}<br/>{0,2,4,7,10,15,17,18,22,24}<br/>{0,2,4,7,13,15,17,18,22,24}| | |
|d34|{0,2,4,6,15,17,19,20}|Decoder3 (also)|All rotate and flag opcodes (x7/xF) in range 0x00-0x3f|
|d35|{0,2,4,6,13,14,16,19,24}| |All ADD HL,r16 opcodes (0x09,0x19,0x29,0x39)|
|d36|{0,2,4,6,13,14,17,19,22,24}| | |
|d37|{0,2,4,6,12,14,17,19,22,24}| | |
|d38|{0,2,5,7,12,15,16,19,22,25}|Decoder3 (also)|Push opcodes (0xc5,0xd5,0xe5,0xf5)|
|d39|{0,2,5,7,12,15,16,19,22,24}| | |
|d40|{0,2,4,7,8,19,20}<br/>{0,2,4,7,8,16,20}<br/>{0,2,4,7,8,14,20}<br/>{0,2,4,7,10,19,20}<br/>{0,2,4,7,10,16,20}<br/>{0,2,4,7,10,14,20}<br/>{0,2,4,7,13,19,20}<br/>{0,2,4,7,13,16,20}<br/>{0,2,4,7,13,14,20}| |All LD opcodes in range 0x40-0x7f, except using (HL) and HALT.|
|d41|{0,2,4,7}|Decoder3 (not used in Decoder2)|All LD reg/(HL), (HL)/reg, including HALT (in range 0x40-0x7f)|
|d42|{0,3,4,6}|Decoder3, ALU, Bottom (not used in Decoder2)|Pop opcodes (0xc1, 0xd1, 0xe1, 0xf1)|
|d43|{0,2,5,7,8,10,12,14,17,22,24}<br/>{0,2,5,7,8,14,17,18,22,24}| | |
|d44|{0,2,5,7,8,10,12,14,17,22,25}<br/>{0,2,5,7,8,14,17,18,22,25}| | |
|d45|{0,2,5,7,8,10,12,14,17,23,24}<br/>{0,2,5,7,8,14,17,18,23,24}| | |
|d46|{0,2,4,6,13,14,16,19,22,25}| | |
|d47|{0,2,4,6,9,11,12,15,17,18,22,25}| | |
|d48|{24,25}|:warning: Not used| |
|d49|{24,25}|:warning: Not used| |
|d50|{0,2,5,7,12,15,16,19,23,24}| | |
|d51|{0,2,5,7,12,14,16,19,22,24}| | |
|d52|{0,2,5,7,12,14,16,19,22,25}| | |
|d53|{0,2,5,7,9,10,13,14,16,18,20,22,24}| | |
|d54|{0,2,5,7,9,11,13,14,16,18,22,25}| | |
|d55|{0,3,5,7,14,22,24}<br/>{0,3,5,7,16,22,24}<br/>{0,3,5,7,19,22,24}| | |
|d56|{0,3,5,7,15,17,18,22,25}| | |
|d57|{0,3,5,7,15,17,18,22,24}| | |
|d58|{0,2,5,7,12,14,16,19,23,24}|ALU (also)| |
|d59|{0,2,5,7,9,11,12,14,16,18,22,25}| | |
|d60|{0,2,4,6,8,10,13,14,16,18,20,23,24}|Bottom (also)| |
|d61|{0,2,4,6,8,10,13,14,16,18,20,22,24}| | |
|d62|{0,2,5,7,9,11,13,14,16,19,22,24}|Decoder3 (also)| |
|d63|{0,2,5,7,9,10,13,14,16,18,20,22,24}| | |
|d64|{0,2,5,7,9,10,13,14,16,18,20,23,25}|Decoder3 (also)| |
|d65|{0,2,5,7,9,11,13,14,16,18,22,24}| | |
|d66|{0,2,4,6,8,10,13,14,16,18,20,23,25}| | |
|d67|{0,2,4,6,8,10,13,14,16,18,20,22,25}| | |
|d68|{0,2,4,7,9,11,12,19,22,24}<br/>{0,2,4,7,9,11,12,16,22,24}<br/>{0,2,4,7,9,11,12,14,22,24}| | |
|d69|{0,2,4,6,9,11,12,15,16,22,24}| | |
|d70|{0,2,4,6,9,11,12,15,16,22,25}| | |
|d71|{0,2,5,7,9,11,12,14,17,18,22,24}| | |
|d72|{0,2,5,7,9,11,12,14,16,18,22,24}| | |
|d73|{0,2,5,7,15,17,19,22,25}| | |
|d74|{0,2,5,7,15,17,19,22,24}| | |
|d75|{1,2,21,22,25}| | |
|d76|{1,2,21,22,24}| | |
|d77|{1,2,20,22,24}| | |
|d78|{0,2,5,6,16,20}<br/>{0,2,5,6,14,20}<br/>{0,2,5,6,19,20}| | |
|d79|{0,2,5,7,8,13,14,16,19,22,24}| | |
|d80|{0,2,5,7,8,14,16,18,22,25}| | |
|d81|{0,2,5,7,9,10,13,14,16,19,20}| | |
|d82|{0,2,5,7,8,13,14,16,20,23,24}<br/>{0,2,5,7,8,14,16,18,20,23,24}| | |
|d83|{0,2,5,7,8,13,14,16,20,23,25}<br/>{0,2,5,7,8,14,16,18,20,23,25}|Decoder3 (also)| |
|d84|{0,2,4,6,9,10,14,17,18,22,24}| | |
|d85|{0,2,4,6,9,11,14,17,18,22,24}| | |
|d86|{0,2,4,6,12,14,16,19,22,24}| | |
|d87|{0,2,4,6,12,14,16,19,22,25}| | |
|d88|{0,2,4,6,12,14,16,19,23,24}|Decoder3 (also). Long wire.| |
|d89|{0,2,4,6,13,15,16,20}<br/>{0,2,4,6,10,15,16,20}<br/>{0,2,4,6,8,15,16,20}| | |
|d90|{0,2,5,6,15,17,18,22,24}| | |
|d91|{0,2,5,7,15,17,18,22,24}| | |
|d92|{0,2,5,7,15,17,19,23,24}|Bottom (also)| |
|d93|{1,2,21,23,24}|Decoder3, Bottom (also)| |
|d94|{0,3,19,20}<br/>{0,3,14,20}<br/>{0,3,16,20}| | |
|d95|{0,3,15,17,18,22,24}| | |
|d96|{0,3,4,7,15,17,18,22,25}| | |
|d97|{0,3,6,15,17,18,22,25}| | |
|d98|{0,2,4,6,15,16}| |INC/DEC reg/(HL)|
|d99|{0,2,5,7,9,11,14,17,19,20}|Sequencer (also)| |
|d100|{0,2,4,7,9,11,12,15,17,18,20}|Sequencer (also)| |
|d101|{0,2,4,6,8,12,14,16,18,20}|Sequencer (also)| |
|d102|{0,2,5,7,8,10,13,14,17,19,20}|Sequencer (also)| |
|d103|{0,2,4,6,8,11,13,14,16,18,23,24}<br/>{0,2,4,6,9,14,16,18,23,24}| | |
|d104|{0,2,5,7,9,13,14,17,18,20,22,24}| | |
|d105|{0,2,5,7,9,13,14,17,18,20,22,25}| | |
|d106|{24,25}|:warning: Not used| |

The numbers in the tree path mark the inputs `a[25:0]`.

The result should be as follows (using d3 as an example, the dynamical part of the logic is not shown):

![demo_d3](/imgstore/demo_d3.jpg)

The `To` outputs are marked only for those that go somewhere else besides Decoder2.

To convert trees into a schematic, you can use a script to generate an HDL.
